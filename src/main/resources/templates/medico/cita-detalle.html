<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle de Cita</title>
    <style>
        * {
            font-family: arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: #f8f9fa;
            padding: 2rem;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 1rem;
        }
        .card h2 {
            color: #059669;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #059669;
            padding-bottom: 0.5rem;
        }
        .info-row {
            display: flex;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .info-row:last-child {
            border-bottom: none;
        }
        .info-label {
            font-weight: bold;
            width: 200px;
            color: #374151;
        }
        .info-value {
            flex: 1;
            color: #6b7280;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
            margin-right: 0.5rem;
        }
        .btn-back {
            background-color: #3b82f6;
            color: white;
        }
        .btn-back:hover {
            background-color: #2563eb;
        }
        .btn-success {
            background-color: #059669;
            color: white;
        }
        .btn-success:hover {
            background-color: #047857;
        }
        .btn-danger {
            background-color: #dc2626;
            color: white;
        }
        .btn-danger:hover {
            background-color: #b91c1c;
        }
        .estado-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
        }
        .estado-programada { background-color: #3b82f6; color: white; }
        .estado-en-curso { background-color: #f59e0b; color: white; }
        .estado-completada { background-color: #059669; color: white; }
        .estado-cancelada { background-color: #6b7280; color: white; }
        .estado-no-asistio { background-color: #dc2626; color: white; }
        .actions {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
        }
    </style>
</head>
<body>
<div class="container">
    <a th:href="@{/medico/dashboard/citas}" class="btn btn-back">‚Üê Volver a Mis Citas</a>
    
    <div class="card">
        <h2>Informaci√≥n de la Cita</h2>
        <div class="info-row">
            <div class="info-label">Estado:</div>
            <div class="info-value">
                <span th:class="'estado-badge estado-' + ${#strings.toLowerCase(#strings.replace(cita.estado, ' ', '-'))}" 
                      th:text="${cita.estado}">Estado</span>
            </div>
        </div>
        <div class="info-row">
            <div class="info-label">Fecha:</div>
            <div class="info-value" th:text="${#dates.format(cita.fecha, 'dd/MM/yyyy')}">Fecha</div>
        </div>
        <div class="info-row">
            <div class="info-label">Hora:</div>
            <div class="info-value" th:text="${cita.hora}">Hora</div>
        </div>
        <div class="info-row">
            <div class="info-label">Tipo de Cita:</div>
            <div class="info-value" th:text="${cita.cita}">Tipo</div>
        </div>
    </div>

    <div class="card">
        <h2>Informaci√≥n del Paciente</h2>
        <div class="info-row">
            <div class="info-label">Nombre Completo:</div>
            <div class="info-value" th:text="${cita.paciente.nombre + ' ' + cita.paciente.apellido}">Nombre</div>
        </div>
        <div class="info-row">
            <div class="info-label">Tipo de Documento:</div>
            <div class="info-value" th:text="${cita.paciente.tipoDoc}">Tipo Doc</div>
        </div>
        <div class="info-row">
            <div class="info-label">N√∫mero de Documento:</div>
            <div class="info-value" th:text="${cita.paciente.numeroDoc}">N√∫mero</div>
        </div>
        <div class="info-row">
            <div class="info-label">Tel√©fono:</div>
            <div class="info-value" th:text="${cita.paciente.telefono}">Tel√©fono</div>
        </div>
        <div class="info-row">
            <div class="info-label">Correo:</div>
            <div class="info-value" th:text="${cita.paciente.correo}">Correo</div>
        </div>
    </div>

    <div class="card">
        <h2>Acciones</h2>
        <div class="actions">
            <!-- Bot√≥n Atender Paciente - solo visible si es HOY y est√° Programada o En Curso -->
            <a th:if="${(cita.estado == 'Programada' || cita.estado == 'En Curso') && 
                       cita.fecha.toString() == #dates.format(#dates.createNow(), 'yyyy-MM-dd')}"
               th:href="@{/medico/dashboard/pacientes/{id}/historia/nueva(id=${cita.paciente.idPaciente}, citaId=${cita.idAgendamiento})}" 
               class="btn btn-success">
                ‚úì Atender Paciente
            </a>
            
            <!-- Mensaje si la cita es futura -->
            <p th:if="${(cita.estado == 'Programada' || cita.estado == 'En Curso') && 
                       cita.fecha.toString() != #dates.format(#dates.createNow(), 'yyyy-MM-dd')}"
               style="color: #3b82f6; font-weight: 600;">
                üìÖ Esta cita est√° programada para el <span th:text="${#dates.format(cita.fecha, 'dd/MM/yyyy')}"></span>. 
                Podr√° atender al paciente el d√≠a de la cita.
            </p>
            
            <!-- Bot√≥n Cancelar Cita - solo visible si est√° Programada o En Curso -->
            <form th:if="${cita.estado == 'Programada' || cita.estado == 'En Curso'}"
                  th:action="@{/medico/dashboard/citas/{id}/cancelar(id=${cita.idAgendamiento})}" 
                  method="POST" 
                  onsubmit="return confirm('¬øEst√° seguro de que desea cancelar esta cita?');"
                  style="display: inline;">
                <button type="submit" class="btn btn-danger">‚úó Cancelar Cita</button>
            </form>
            
            <!-- Mensaje si la cita ya fue atendida/cancelada -->
            <p th:if="${cita.estado == 'Completada'}" style="color: #059669; font-weight: 600;">
                ‚úì Esta cita ya fue completada
            </p>
            <p th:if="${cita.estado == 'Cancelada'}" style="color: #6b7280; font-weight: 600;">
                Esta cita fue cancelada
            </p>
            <p th:if="${cita.estado == 'No Asisti√≥'}" style="color: #dc2626; font-weight: 600;">
                El paciente no asisti√≥ a esta cita
            </p>
        </div>
    </div>
</div>
</body>
</html>
